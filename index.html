<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Sales History</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .main-wrapper {
            padding: 20px;
            text-align: center;
        }
        button {
            background-color: #333;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        button:hover {
            background-color: #555;
        }
        /* Modal Styles */
        #sales-history-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            width: 80%;
            max-height: 80%;
            overflow-y: auto;
            position: relative;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        .modal-header h2 {
            margin: 0;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
        }
        #sales-history-list li {
            list-style: none;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .filter-section {
            margin-bottom: 15px;
        }
        .filter-section input {
            margin-right: 10px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #sales-history-list {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<div class="main-wrapper">
    <h1>Store Management</h1>
    <button onclick="openSalesHistoryModal()">View Full Sales History</button>
</div>

<!-- Full Sales History Modal -->
<div id="sales-history-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Full Sales History</h2>
            <button class="close-btn" onclick="closeSalesHistoryModal()">✖</button>
        </div>
        <div class="filter-section">
            <input type="text" id="search-box" placeholder="Search by product name" oninput="filterSalesHistory()">
            <input type="date" id="start-date">
            <input type="date" id="end-date">
            <button onclick="filterSalesByDate()">Filter by Date</button>
            <button onclick="downloadSalesHistoryAsCSV()">Download CSV</button>
        </div>
        <ul id="sales-history-list"></ul>
    </div>
</div>

<script>
    // Sample Sales Data
    const salesData = [
        { shopName: "Shop A", productName: "Product 1", productQuantity: 2, total: 200, time: "2024-11-30 12:30 PM" },
        { shopName: "Shop B", productName: "Product 2", productQuantity: 1, total: 150, time: "2024-11-30 01:15 PM" },
        { shopName: "Shop A", productName: "Product 3", productQuantity: 3, total: 300, time: "2024-11-30 02:00 PM" }
    ];

    // Open Modal
    function openSalesHistoryModal() {
        const modal = document.getElementById("sales-history-modal");
        const salesHistoryList = document.getElementById("sales-history-list");

        modal.style.display = "flex";
        salesHistoryList.innerHTML = ""; // Clear previous history

        salesData.forEach((sale, index) => {
            const listItem = `
                <li>
                    <strong>Sale #${index + 1}</strong><br>
                    <strong>Shop:</strong> ${sale.shopName}<br>
                    <strong>Product:</strong> ${sale.productName}<br>
                    <strong>Quantity:</strong> ${sale.productQuantity}<br>
                    <strong>Total:</strong> ৳${sale.total.toFixed(2)}<br>
                    <strong>Time:</strong> ${sale.time}
                </li>
            `;
            salesHistoryList.innerHTML += listItem;
        });
    }

    // Close Modal
    function closeSalesHistoryModal() {
        const modal = document.getElementById("sales-history-modal");
        modal.style.display = "none";
    }

    // Filter Sales History
    function filterSalesHistory() {
        const searchQuery = document.getElementById("search-box").value.toLowerCase();
        const salesHistoryList = document.getElementById("sales-history-list");

        salesHistoryList.innerHTML = ""; // Clear previous history

        const filteredSales = salesData.filter(sale =>
            sale.productName.toLowerCase().includes(searchQuery)
        );

        if (filteredSales.length === 0) {
            salesHistoryList.innerHTML = "<li>No matching sales found.</li>";
        } else {
            filteredSales.forEach((sale, index) => {
                const listItem = `
                    <li>
                        <strong>Sale #${index + 1}</strong><br>
                        <strong>Shop:</strong> ${sale.shopName}<br>
                        <strong>Product:</strong> ${sale.productName}<br>
                        <strong>Quantity:</strong> ${sale.productQuantity}<br>
                        <strong>Total:</strong> ৳${sale.total.toFixed(2)}<br>
                        <strong>Time:</strong> ${sale.time}
                    </li>
                `;
                salesHistoryList.innerHTML += listItem;
            });
        }
    }

    // Filter Sales By Date
    function filterSalesByDate() {
        const startDate = new Date(document.getElementById("start-date").value);
        const endDate = new Date(document.getElementById("end-date").value);
        const salesHistoryList = document.getElementById("sales-history-list");

        salesHistoryList.innerHTML = ""; // Clear previous history

        if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
            alert("Please select valid start and end dates.");
            return;
        }

        const filteredSales = salesData.filter(sale => {
            const saleDate = new Date(sale.time);
            return saleDate >= startDate && saleDate <= endDate;
        });

        if (filteredSales.length === 0) {
            salesHistoryList.innerHTML = "<li>No sales found for the selected date range.</li>";
        } else {
            filteredSales.forEach((sale, index) => {
                const listItem = `
                    <li>
                        <strong>Sale #${index + 1}</strong><br>
                        <strong>Shop:</strong> ${sale.shopName}<br>
                        <strong>Product:</strong> ${sale.productName}<br>
                        <strong>Quantity:</strong> ${sale.productQuantity}<br>
                        <strong>Total:</strong> ৳${sale.total.toFixed(2)}<br>
                        <strong>Time:</strong> ${sale.time}
                    </li>
                `;
                salesHistoryList.innerHTML += listItem;
            });
        }
    }

    // Download Sales History as CSV
    function downloadSalesHistoryAsCSV() {
        const csvRows = ["Shop Name,Product Name,Quantity,Total,Time"];
        salesData.forEach(sale => {
            csvRows.push(
                `${sale.shopName},${sale.productName},${sale.productQuantity},${sale.total.toFixed(2)},${sale.time}`
            );
        });

        const csvString = csvRows.join("\n");
        const blob = new Blob([csvString], { type: "text/csv" });
        const downloadAnchor = document.createElement('a');
        downloadAnchor.href = URL.createObjectURL(blob);
        downloadAnchor.download = "sales_history.csv";
        document.body.appendChild(downloadAnchor);
        downloadAnchor.click();
        document.body.removeChild(downloadAnchor);
    }
</script>
</body>
</html>
